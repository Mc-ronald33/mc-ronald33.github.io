webpackJsonp([7,35],{62:function(e,t){"use strict";var n=null,o={};o.get=function(){return n},o.set=function(e){n=e},e.exports=o},115:function(e,t,n){e.exports=function(){return new Promise(function(e){n.e(17,function(t){e(n(284))})})}},120:function(e,t,n){"use strict";var o=n(11),s=n(13),i=n(116),a=n(115),r=n(9),c=n(1747),u=n(1748),v=n(1745),d=n(1746),h=n(36),l=n(27),p=n(39),f=n(47),_=n(62),C=n(7),g=n(162),m=n(5),y=n(60),I=n(19),A=n(18),E=5,T="activeConversations",b=72,R=function w(){this.activeConversationsContainer=null,this.conversations={},this.conversationIdToLastMessageId={},this.conversationIds=[],this._openConversation=null,this._logger=f.getLogger("ConversationsManager"),this.conversationsUpdater=new v(this)};Object.assign(R.prototype,i),Object.assign(R.prototype,{_fetchingConversations:!1,_loadedInitialConversations:!1,_pendingRequest:null,getContainer:function N(){return this.activeConversationsContainer},setContainer:function k(e){this.activeConversationsContainer=e},listenForConversations:function M(){var e=this;A.isAuthenticated()&&!A.isLimitedLogin()&&d().then(function(t){e.listenTo(t.instance(),"conversations_unseen_count",e.onUnseenConversationsCount)})},onUnseenConversationsCount:function P(e){var t=this;e>0||this._shouldUpdateConversations?this._fetchConversations().then(function(n){t._shouldUpdateConversations=!1,t._updateActiveConversations(n),C.instance.publish("site","conversationUnreadCount",e)}):C.instance.publish("site","conversationUnreadCount",e)},_fetchConversations:function O(){var e=this;return this._fetchingConversations||!function(){var t=m.create("ConversationsResource",{});e._pendingRequest=g.instance.callGet(t),e._pendingRequest.then(function(){e._conversationsBookmarks=t.get("bookmarks")}).fin(function(){e._fetchingConversations=!1}),e._fetchingConversations=!0}(),this._pendingRequest},getConversationsBookmarks:function L(){return this._conversationsBookmarks},_updateActiveConversations:function U(e){var t=this;o.each(e,function(e){var n=e.id,s=e.last_message,i=t.conversationIdToLastMessageId[n];s&&s.id!==i&&(o.isUndefined(i)&&e.unread<=0||(o.contains(t.conversationIds,n)?t.conversations[n].updateConversation(e):s.sender.id!==A.get("id")&&t.addConversation(e,!1),t.conversationIdToLastMessageId[n]=s.id))})},deleteConversationBadgeCount:function S(){var e=m.create("ConversationBadgeResource",{});e.callDelete({showError:!1})},sendMessageToUsers:function x(e,t,n){var o=this,s={user_ids:e||[],emails:t||[]},i=this._sendNewMessage("ConversationsResource",s,n);return i.then(function(e){var t=e.resource_response.data;o.addConversation(t)}),i},sendMessageToConversation:function B(e,t){var n={conversation_id:e};return this._sendNewMessage("ConversationMessagesResource",n,t)},_sendNewMessage:function D(e,t,n){var o=this;n.text&&(t.text=n.text),n.object_id&&(t[n.object_type]=n.object_id);var s=m.create(e,t),i=s.callCreate({error:this._handleSendMessageError.bind(this)});return i.then(function(){o._shouldUpdateConversations=!0}),i},_handleSendMessageError:function j(e){var t=e.extra_data;243===e.api_error_code&&t.objects&&!function(){var e=t.objects;a().then(function(t){var n=new t({options:{template:"message_object_auth_error",attached_object:e.object,users:e.users,emails:e.emails}});_.get().createAndShowModal(n)})}()},logContextEvent:function H(e,t,n,o){var s=h.fromEventType(e);if(n&&s.setObjectIdStr(n),o){if(o.attr("data-element-type")){var i=parseInt(o.attr("data-element-type"),10);s.setElement(i)}var a=o.closest("[data-component-type]");if(a.length){var r=parseInt(a.attr("data-component-type"),10);s.setComponent(r)}}s.updateAuxData({conversation_id:t}),l.getInstance().addEvent(s)},_addConversationToDom:function q(e,t,n){var s=this,i=this.getContainer();if(!i)return Promise.resolve(void 0);var a=e.id;this.conversationIds.push(a),this.cacheActiveConversations();var r={id:a};return A.isAuthenticated()&&!A.isLimitedLogin()||(r.unauth=!0),e.users=o.reject(e.users,function(e){return e.id===A.get("id")}),t&&(r.peek=!1),c().then(function(o){var c=new o({options:r,data:e}),u=c.renderExistingData().then(function(){s.conversations[a]=c,s.resetConversationHeadTransforms(),i.appendChild(c),n&&c.setInactive(),c.setBadgeCount(e.unread),t?s.openConversation(c):s._openConversation&&s._openConversation.adjustPopup(),c.focus(),s._ensureWithinMaxNumberOfConversations()});return u})},_animateAddConversation:function F(e,t){var n=this,s=o.reject(e.users,function(e){return e.id===A.get("id")}),i=function(){this._addConversationToDom(e,t)}.bind(this);t&&this._openConversation&&this._openConversation.closePopup(),u().then(function(t){var o=e&&e.board,a=new t({options:{users:s,emails:e.emails,group_board_name:o&&o.name,group_board_rep_url:o&&o.image_thumbnail_url}});a.render().then(function(){var e=n._makeAnimatedElement(a.$el);n._animateShowConversationHead(e,i)})})},_makeAnimatedElement:function V(e){var t=e.clone();return t.addClass("cloned").offset({left:-1e3,top:-1e3}).appendTo(s("body")),t},_animateShowConversationHead:function G(e,t){var n=this.getContainer(),o=n.getContent(),i=o.offset(),a=i.left,c=i.top,u=n.getHeight(!0),v=o.find(".ConversationHead");v.transition({y:-b},280,"ease"),e.addClass("normal opening"),e.removeClass("medium small"),e.width(r.ACTIVE_CONVERSATION_HEAD_DIMENSION).height(r.ACTIVE_CONVERSATION_HEAD_DIMENSION).css("visibility","hidden"),e.offset({left:a,top:c+u-r.ACTIVE_CONVERSATION_HEAD_DIMENSION-3}),e.transition({scale:0,duration:1},function(){s(this).css("visibility","")}).transition({scale:1.2,duration:180}).transition({scale:1,duration:100},function(){t(),e.remove()})},cacheActiveConversations:function W(){var e=this;if(!p.getInstance().v2InGroup("react_conversations",["enabled","enabled2","employees"])){var t=this.conversationIds.filter(function(t){return!e.conversations[t]||!e.conversations[t].data.board});y.localStorage.setItem(T,t)}},_ensureWithinMaxNumberOfConversations:function J(){if(this.conversationIds.length>E){var e=this.conversationIds[0];this.removeOverboundsConversation(e)}},removeOverboundsConversation:function K(e){var t=this,n=this.conversations[e],o=n.getContent();o.transition({scale:.8},200).transition({scale:2,opacity:0},200,"ease",function(){t.resetConversationHeadTransforms(),t.removeConversationById(e)})},loadInitialConversations:function Y(e){var t=this,n=y.localStorage.getItem(T);n&&n.length||(n=[],this._publishNoActiveConversationsIfNeeded());var s=[].concat(n);this._fetchConversations().then(function(n){var i=!!e,a=o.map(n,function(n){if(!n.board){var a=n.id===e;return a?(i=!1,t._addConversationToDom(n,!0)):o.contains(s,n.id)?t._addConversationToDom(n,!1):void 0}});Promise.all(a).then(function(){t._updateActiveConversations(n),i&&t.addConversationById(e,!0),C.instance.publish("currentMessages","conversationsLoaded"),t._loadedInitialConversations=!0}),t.cacheActiveConversations()})},hasLoadedInitialConversations:function $(){return this._loadedInitialConversations},addConversation:function Q(e,t){o.isUndefined(t)&&(t=!0),C.instance.publish("messages","conversationAdded");var n=e.id,s=this.conversations[n];s?(s.updateConversation(e),t&&this.openConversation(s)):this._animateAddConversation(e,t)},addConversationById:function z(e,t){var n=this;if(o.contains(this.conversationIds,e))return void(t&&this.openConversation(this.conversations[e]));var s=m.create("ConversationResource",{conversation_id:e});s.callGet({showError:!1}).then(function(e){var o=e.resource_response.data;n.addConversation(o,t)})},addConversationForUnauthUser:function X(e){var t=this,n=I.getQueryStringParams(),o=n.user_id,s=n.od;if(o&&s){var i=m.create("UnauthConversationResource",{conversation_id:e,user_id:o,od:s});i.callGet().then(function(e){var n=e.resource_response.data;t._unauthUserEmail=n.unauth_user_email;var o=n.conversation;t.addConversation(o,!0)})}},getUnauthUserEmail:function Z(){return this._unauthUserEmail},listenForActiveConversationUpdates:function ee(){A.isAuthenticated()&&!A.isLimitedLogin()&&(d().then(function(e){e.instance().setMinPoll(r.UPDATES_WITH_ACTIVE_CONVERSATIONS_MIN_POLL)}),this.conversationsUpdater.activate(),this.activeConversationsListener||(this.activeConversationsListener=this.listenTo(this.conversationsUpdater,"active_conversations",this.onActiveConversationsUpdate)))},getOpenConversationId:function te(){return this._openConversation?this._openConversation.data.id:!1},onActiveConversationsUpdate:function ne(e){this._updateActiveConversations(e)},stopListeningForActiveConversationUpdates:function oe(){A.isAuthenticated()&&!A.isLimitedLogin()&&(this.conversationsUpdater.deactivate(),d().then(function(e){e.instance().setMinPoll(r.UPDATES_MIN_POLL)}),this.activeConversationsListener&&(this.stopListening(this.activeConversationsListener),this.activeConversationsListener=null))},getConversationIds:function se(){return this.conversationIds},hasActiveConversations:function ie(){return this.getConversationIds().length>0},resetConversationHeadTransforms:function ae(){var e=this.getContainer();e&&e.$(".ConversationHead").css("transform","")},scaleConversationDownAndRemove:function re(e){var t=this,n=this.conversations[e],s=n.getContent(),i=o.indexOf(this.conversationIds,e),a=this.getContainer().getConversationHeads(),r=a.slice(0,i);s.transition({scale:1.1},120,function(){r.length&&r.transition({y:b},140)}).transition({scale:0},140,"ease",function(){t.resetConversationHeadTransforms(),t.removeConversationById(e)})},removeConversationById:function ce(e){if(this.conversationIds=o.without(this.conversationIds,e),this.conversations[e]){this._openConversation&&(this._openConversation.getConversationId()===e?this.closeConversation(this._openConversation):this._openConversation.adjustPopup());var t=this.conversations[e];t.destroy(),delete this.conversations[e],this.cacheActiveConversations(),this._publishNoActiveConversationsIfNeeded()}},_publishNoActiveConversationsIfNeeded:function ue(){0===this.conversationIds.length&&C.instance.publish("messages","conversationNoActiveConversations")},closeAllConversations:function ve(){var e=this;o.each(this.conversations,function(t){e.closeConversation(t)})},closeConversation:function de(e){this.stopListeningForActiveConversationUpdates(),this.setAllActive(),e.closePopup(),this._openConversation===e&&(this._openConversation=null,C.instance.publish("messages","conversationClosed",null))},setAllActive:function he(){o.each(this.conversations,function(e){e.setActive()})},setAllInactive:function le(e){var t=this;o.each(this.conversations,function(e){e!==t._openConversation&&e.setInactive()})},closeConversationById:function pe(e){var t=this.conversations[e];t&&this.closeConversation(t)},openConversation:function fe(e){this.conversations[e.getConversationId()]&&(this._openConversation?(this._openConversation.setInactive(),this._openConversation.closePopup()):this.setAllInactive(e),this._openConversation=e,this._openConversation.setActive(),e.showPopup(),C.instance.publish("messages","conversationOpen",null),this.listenForActiveConversationUpdates())}}),e.exports=new R},162:function(e,t,n){"use strict";var o=n(11),s=n(46),i=n(2930),a=n(3025),r={};r.Freshness={POSSIBLY_STALE_AND_INCOMPLETE:1,FRESH:2};var c=["NetworkStoriesResource","NotificationsResource","ConversationsResource","BoardInvitesResource"],u=function f(e){return o.isObject(e)?o.sortBy(o.map(o.pairs(e),function(e){return[e[0],f(e[1])]}),function(e){return e[0]}):e},v=function _(e){return JSON.stringify(u(e))},d=function C(){};d.prototype.ensureModel=function(e,t){},d.prototype.invalidate=function(e){};var h=function g(e,t){this._entityType=e,this._modelManager=t};h.prototype.ensureModel=function(e,t){var n=e.options.id;return this._modelManager.ensureModel(this._entityType,n,t)},h.prototype.invalidate=function(e){};var l=function m(){this._cache={},this._bookmarkResponses={}};l.prototype._getKey=function(e){var t=o.omit(e.options,"bookmarks");return t.bookmark=e.getLatestBookmark(),v(t)},l.prototype.ensureModel=function(e,t){var n=this._getKey(e),s=this._cache[n];return-1!==o.indexOf(c,e.name)&&e.options.bookmarks&&(s=null),s?s.updateData(t):s=this._cache[n]=new i(t),s},l.prototype.invalidate=function(e){this._cache={}},l.prototype.getBookmarkResponse=function(e){return this._bookmarkResponses[e]},l.prototype.setBookmarkResponse=function(e,t){this._bookmarkResponses[e]=t};var p=function y(e){this._resourceCacheStrategies=e};p.prototype.callGet=function(e,t,n){var s=t&&t.module,i=this._resourceCacheStrategies[e.name],a=e.getLatestBookmark(),u=-1!==o.indexOf(c,e.name),v=e.callGet({showError:!1},void 0,t&&t.headers).then(function(e){return u&&(i.setBookmarkResponse(a,e.bookmarks),s&&s.resource.setBookmarks(e.bookmarks)),e.resource_response.data});if(i){var d=i.ensureModel(e,v);return n&&n.freshness===r.Freshness.POSSIBLY_STALE_AND_INCOMPLETE?(u&&s.resource.setBookmarks(i.getBookmarkResponse(a)),d.getNonEmptyData()):v}return v},p.prototype.callCreate=function(e){var t=e.callCreate();return t.then(function(){"PinCommentResource"===e.name&&a.instance.invalidate(a.EntityType.PIN,e.options.pin_id)}),t},p.prototype.ensureModel=function(e,t){var n=this._resourceCacheStrategies[e.name];return n?n.ensureModel(e,Promise.resolve(t)):null},p.prototype.invalidate=function(e){var t=this._resourceCacheStrategies[e.name];t&&t.invalidate(e)},r.instance=r.instance||new p({PinResource:new h(a.EntityType.PIN,a.instance),BoardsResource:new l,BoardPickerBoardsResource:new l,ConversationsResource:new l,NotificationsResource:new l,NetworkStoriesResource:new l,UserExperienceWithContextResource:new l,BoardInvitesResource:new l}),e.exports=s.expose("resourceCache",r)},1745:function(e,t,n){"use strict";var o=n(116),s=n(9),i=n(5),a=function r(e){this.conversationsManager=e,this.conversationsUpdatesResource=i.create("ConversationsUpdatesResource",{}),this.poller=null,this._numRetries=0,this._requestConversationId=null,this._pollInterval=null};Object.assign(a.prototype,o),Object.assign(a.prototype,{fetch:function c(){var e=this;if(!this.pendingRequest){var t=this.conversationsManager.getOpenConversationId();t&&(this.pendingRequest=!0,this._requestConversationId!==t&&(this._requestConversationId=t,this.conversationsUpdatesResource.resetBookmark(),this.conversationsUpdatesResource.setOptions({conversation_ids:[this._requestConversationId]})),this.conversationsUpdatesResource.callGet({showError:!1}).then(function(t){e.pendingRequest=!1,e._numRetries=0;var n=t.resource_response.data,o=n.updated_conversations||[];e._activated&&n.wait&&e._setNextPoll(1e3*n.wait),o.length>0&&e.trigger("active_conversations",o)},function(){e.pendingRequest=!1,e.deactivateIfNecessary()}))}},deactivateIfNecessary:function u(){this._numRetries+=1,this._numRetries>5&&this.deactivate()},deactivate:function v(){this._resetPoller(),this.pendingRequest=!1,this._activated=!1},activate:function d(){this._setNextPoll(s.OPEN_CONVERSATION_MIN_POLL),this._numRetries=0,this._activated=!0},_setNextPoll:function h(e){var t=this;this.pendingRequest||(e&&this._pollInterval===e||this._resetPoller(),e&&this._pollInterval!==e&&(this.poller=window.setInterval(function(){t.fetch()},e)),this._pollInterval=e)},_resetPoller:function l(){this.poller&&clearInterval(this.poller),this.poller=null,this._pollInterval=null},isActive:function p(){return this._activated}}),e.exports=a},1746:function(e,t,n){e.exports=function(){return new Promise(function(e){n.e(131,function(t){e(n(1054))})})}},1747:function(e,t,n){e.exports=function(){return new Promise(function(e){n.e(78,function(t){e(n(1347))})})}},1748:function(e,t,n){e.exports=function(){return new Promise(function(e){n.e(79,function(t){e(n(303))})})}},2930:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(945),a=o(i),r=function(){function e(t){var n=this;s(this,e),this._data=null,this._onChangeHandler=function(){},this._modelAvailablePromise=t.then(function(e){n.set(e)})}return e.prototype.set=function t(e){var t=e instanceof Array;if(this._data){var n=void 0;t?n=e:(n=this._data,a["default"].deepExtend(!0,n,e)),this._data=n,this._onChangeHandler(this)}else this._data=e,this._onChangeHandler(this)},e.prototype.updateData=function n(e){var t=this;e.then(function(e){t.set(e)})},e.prototype.getNonEmptyData=function o(){var e=this;return this._modelAvailablePromise.then(function(t){return e.getData()})},e.prototype.getData=function i(){return this._data},e.prototype.onChange=function r(e){var t=this;this._modelAvailablePromise.then(function(){t._onChangeHandler=e})},e}();e.exports=r},3025:function(e,t,n){"use strict";var o=n(11),s=n(909),i=n(2930),a={};a.EntityType={PIN:"pin"},a.EntityDict,a.EntityId;var r=1e3,c=function v(e){this.cache=new s(r),this._entityType=e};c.prototype.getModel=function(e){return this.cache.get(e)},c.prototype.addEntityDict=function(e){if(e.type!==this._entityType)throw new Error("invalid entityDict type");var t=e.id;this.ensureModel(t,Promise.resolve(e))},c.prototype.ensureModel=function(e,t){var n=this.cache.get(e);return n||(n=new i(t),this.cache.set(e,n)),n.updateData(t),n},c.prototype.remove=function(e){this.cache.remove(e)};var u=function d(){var e=this;this.entityTypeToCache={},o.each(a.EntityType,function(t){e.entityTypeToCache[t]=new c(t)})};u.prototype.getModel=function(e,t){var n=this.entityTypeToCache[e];return n?n.getModel(t):null},u.prototype.add=function(e){var t=this;if(e instanceof Array)e.forEach(function(e){t._addEntity(e)});else if(e instanceof Object){var n=e;this._addEntity(n)}},u.prototype.ensureModel=function(e,t,n){var o=this.entityTypeToCache[e];if(!o)throw new Error("unexpected entityType "+e);return o.ensureModel(t,n)},u.prototype.invalidate=function(e,t){var n=this.entityTypeToCache[e];if(!n)throw new Error("unexpected entityType "+e);n.remove(t)},u.prototype._addEntity=function(e){var t=e.type;if(t){var n=t,o=this.entityTypeToCache[n];if(o){var s=e.id;"string"==typeof s&&o.ensureModel(s,Promise.resolve(e))}}},a.instance=new u,e.exports=a}});